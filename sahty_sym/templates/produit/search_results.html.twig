{# templates/produit/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}{{ produit.nom }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
    :root {
        --primary-color: #0dcaf0;
        --primary-hover: #0bb6d9;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --light-bg: #f8f9fa;
        --border-color: #dee2e6;
        --text-color: #333;
        --text-muted: #666;
        --discount-color: #ff6b6b;
        --shadow-light: 0 4px 12px rgba(0,0,0,0.05);
        --shadow-medium: 0 8px 24px rgba(0,0,0,0.08);
    }

    body {
        font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        color: var(--text-color);
        background-color: #fff;
        line-height: 1.6;
    }

    .product-container {
        padding: 30px 0;
    }

    .product-main-section {
        background: white;
        border-radius: 16px;
        box-shadow: var(--shadow-light);
        padding: 30px;
        margin-bottom: 30px;
    }

    .product-title {
        color: var(--text-color);
        font-weight: 800;
        font-size: 2.2rem;
        margin-bottom: 1rem;
        line-height: 1.2;
    }

    .product-subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
    }

    .product-image-container {
        position: relative;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-medium);
        background: white;
        padding: 20px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 400px;
    }

    .product-image {
        max-width: 100%;
        max-height: 400px;
        object-fit: contain;
        border-radius: 8px;
    }

    .product-details {
        padding-right: 40px;
    }

    .product-meta {
        margin-bottom: 2rem;
    }

    .meta-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        color: var(--text-muted);
    }

    .meta-icon {
        width: 24px;
        margin-right: 10px;
        color: var(--primary-color);
    }

    .price-section {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 12px;
        padding: 25px;
        margin: 25px 0;
        border: 1px solid var(--border-color);
    }

    .price-display {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 10px;
    }

    .current-price {
        color: var(--primary-color);
        font-size: 2.8rem;
        font-weight: 800;
        line-height: 1;
    }

    .price-currency {
        font-size: 1.8rem;
        color: var(--text-muted);
    }

    .original-price {
        text-decoration: line-through;
        color: var(--secondary-color);
        font-size: 1.5rem;
        font-weight: 500;
    }

    .discount-badge {
        background: linear-gradient(135deg, var(--discount-color) 0%, #ff5252 100%);
        color: white;
        font-weight: 700;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        box-shadow: 0 4px 8px rgba(255,107,107,0.2);
    }

    .action-buttons {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin: 30px 0;
    }

    .btn-command {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
        color: white;
        border: none;
        padding: 16px 40px;
        border-radius: 10px;
        font-weight: 700;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        box-shadow: 0 6px 15px rgba(13,202,240,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        min-width: 220px;
    }

    .btn-command:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(13,202,240,0.4);
        color: white;
    }

    .btn-cart {
        background: white;
        color: var(--primary-color);
        border: 2px solid var(--primary-color);
        padding: 16px 30px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn-cart:hover {
        background: var(--primary-color);
        color: white;
    }

    .quantity-selector {
        display: flex;
        align-items: center;
        gap: 20px;
        margin: 20px 0;
    }

    .quantity-label {
        font-weight: 600;
        color: var(--text-color);
        min-width: 100px;
    }

    .quantity-controls {
        display: flex;
        align-items: center;
        border: 2px solid var(--primary-color);
        border-radius: 10px;
        overflow: hidden;
        background: white;
    }

    .quantity-btn {
        background: white;
        border: none;
        width: 50px;
        height: 50px;
        font-size: 1.5rem;
        font-weight: bold;
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .quantity-btn:hover {
        background: var(--primary-color);
        color: white;
    }

    .quantity-input {
        width: 70px;
        height: 50px;
        text-align: center;
        border: none;
        border-left: 2px solid var(--border-color);
        border-right: 2px solid var(--border-color);
        font-weight: bold;
        font-size: 1.2rem;
        outline: none;
        background: white;
    }

    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin: 25px 0;
    }

    .feature-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: var(--shadow-light);
        border-left: 4px solid var(--primary-color);
        transition: transform 0.3s ease;
    }

    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-medium);
    }

    .feature-icon {
        font-size: 1.5rem;
        color: var(--primary-color);
        margin-bottom: 10px;
    }

    .language-selector {
        margin: 20px 0;
    }

    .language-btn {
        background: white;
        border: 2px solid var(--border-color);
        padding: 8px 16px;
        border-radius: 8px;
        margin-right: 10px;
        transition: all 0.2s ease;
    }

    .language-btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .share-section {
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
    }

    .share-buttons {
        display: flex;
        gap: 10px;
    }

    .share-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        text-decoration: none;
        transition: transform 0.3s ease;
    }

    .share-btn:hover {
        transform: scale(1.1);
    }

 

    .info-section {
        background: var(--light-bg);
        border-radius: 12px;
        padding: 30px;
        margin-top: 20px;
    }

    .section-title {
        color: var(--primary-color);
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 10px;
        margin-bottom: 20px;
        font-weight: 700;
        font-size: 1.4rem;
    }

    .badge-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 15px 0;
    }

    .product-badge {
        background: #e9f9fc;
        color: var(--primary-color);
        border: 1px solid #b6ecf7;
        padding: 6px 15px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    /* Styles pour le tableau des pharmacies */
    .pharmacy-table {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-light);
        border: 1px solid var(--border-color);
    }

    .pharmacy-table th {
        background: linear-gradient(135deg, #0dcaf0 0%, #0bb6d9 100%);
        color: white;
        border: none;
        padding: 15px;
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.9rem;
        letter-spacing: 0.5px;
    }

    .pharmacy-table td {
        padding: 15px;
        vertical-align: middle;
        border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .pharmacy-table tr:hover {
        background-color: rgba(13, 202, 240, 0.08);
    }

    .pharmacy-table .table-primary {
        background-color: rgba(13, 202, 240, 0.15) !important;
    }

    .pharmacy-icon {
        width: 40px;
        height: 40px;
        background: var(--primary-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .price-comparison {
        font-size: 0.85rem;
    }

    .price-cheaper {
        color: var(--success-color);
        font-weight: 600;
    }

    .price-expensive {
        color: var(--discount-color);
        font-weight: 600;
    }

    .price-same {
        color: var(--secondary-color);
    }

    /* Cartes de pharmacie */
    .pharmacy-card {
        border: 2px solid transparent;
        transition: all 0.3s ease;
        border-radius: 12px;
        overflow: hidden;
        height: 100%;
    }

    .pharmacy-card.current {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 1px var(--primary-color);
    }

    .pharmacy-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-medium);
    }

    .pharmacy-price-tag {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    /* Boutons dans le tableau */
    .table-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }

    .table-actions .btn {
        white-space: nowrap;
        flex: 1;
        min-width: 100px;
    }

    /* Responsive */
    @media (max-width: 992px) {
        .product-details {
            padding-right: 0;
            margin-bottom: 30px;
        }
        
        .product-title {
            font-size: 1.8rem;
        }
        
        .action-buttons {
            flex-direction: column;
        }
        
        .btn-command, .btn-cart {
            width: 100%;
            justify-content: center;
        }
    }

    @media (max-width: 768px) {
        .product-main-section {
            padding: 20px;
        }
        
        .current-price {
            font-size: 2.2rem;
        }
        
        .quantity-selector {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .features-grid {
            grid-template-columns: 1fr;
        }
        
        .pharmacy-table {
            font-size: 0.85rem;
        }
        
        .pharmacy-table th,
        .pharmacy-table td {
            padding: 10px 8px;
        }
        
        .pharmacy-table td:nth-child(3),
        .pharmacy-table td:nth-child(4) {
            display: none;
        }
        
        .table-actions {
            flex-direction: column;
        }
        
        .table-actions .btn {
            width: 100%;
        }
    }
    </style>
{% endblock %}

{% block body %}
<div class="container-fluid py-2 border-bottom d-none d-lg-block">
    <div class="container">
        <div class="row">
            <div class="col-md-6 text-center text-lg-start mb-2 mb-lg-0">
                <div class="d-inline-flex align-items-center">
                    <a class="text-decoration-none text-body pe-3" href="#!">
                        <i class="bi bi-telephone me-2"></i>+012 345 6789
                    </a>
                    <span class="text-body">|</span>
                    <a class="text-decoration-none text-body px-3" href="#!">
                        <i class="bi bi-envelope me-2"></i>info@example.com
                    </a>
                </div>
            </div>
            <div class="col-md-6 text-center text-lg-end">
                <div class="d-inline-flex align-items-center">
                    <a class="text-body px-2" href="#!"><i class="fab fa-facebook-f"></i></a>
                    <a class="text-body px-2" href="#!"><i class="fab fa-twitter"></i></a>
                    <a class="text-body px-2" href="#!"><i class="fab fa-linkedin-in"></i></a>
                    <a class="text-body px-2" href="#!"><i class="fab fa-instagram"></i></a>
                    <a class="text-body ps-2" href="#!"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Topbar End -->

<!-- Navbar Start -->
<div class="container-fluid sticky-top bg-white shadow-sm">
    <div class="container">
        <nav class="navbar navbar-expand-lg bg-white navbar-light py-3 py-lg-0">
            <a href="#" class="navbar-brand">
                <h1 class="m-0 text-uppercase text-primary">
                    <i class="fa fa-clinic-medical me-2"></i>Medinova
                </h1>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <div class="navbar-nav ms-auto py-0">
                    <a href="#" class="nav-item nav-link active">Home</a>
                    <a href="#" class="nav-item nav-link">About</a>
                    <a href="#" class="nav-item nav-link">Service</a>
                    <a href="#" class="nav-item nav-link">Laboratoire</a>
                    <a href="#" class="nav-item nav-link">Parapharmacie</a>
                    <a href="#" class="nav-item nav-link">Pricing</a>
                   
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">Pages</a>
                        <div class="dropdown-menu m-0">
                            <a href="#" class="dropdown-item">Blog Grid</a>
                            <a href="#" class="dropdown-item">Blog Detail</a>
                            <a href="#" class="dropdown-item">The Team</a>
                            <a href="#" class="dropdown-item">Testimonial</a>
                            <a href="#" class="dropdown-item">Appointment</a>
                            <a href="#" class="dropdown-item">Search</a>
                        </div>
                    </div>
                    <a href="#" class="nav-item nav-link">Contact</a>
                </div>
            </div>
        </nav>
    </div>
</div>

<div class="container product-container">
    <div class="product-main-section">
        <div class="row">
            <!-- Colonne gauche : Détails produit -->
            <div class="col-lg-6 col-md-12 product-details">
                <!-- Titre et description -->
                <h1 class="product-title">{{ produit.nom }}</h1>
                <p class="product-subtitle">{{ produit.sousTitre ?? 'Produit de qualité professionnelle' }}</p>
                
                <!-- Badges caractéristiques -->
                {% if produit.caracteristiques is defined and produit.caracteristiques %}
                    <div class="badge-list">
                        {% for caracteristique in produit.caracteristiques|slice(0, 4) %}
                            <span class="product-badge">{{ caracteristique.titre }}</span>
                        {% endfor %}
                    </div>
                {% endif %}
                
                <!-- Section multilingue -->
                {% if produit.descriptionsMultilingues is defined and produit.descriptionsMultilingues %}
                    <div class="language-selector">
                        <button class="language-btn active" data-lang="fr">FR</button>
                        {% for desc in produit.descriptionsMultilingues %}
                            {% if desc.langue != 'fr' %}
                                <button class="language-btn" data-lang="{{ desc.langue }}">{{ desc.langue|upper }}</button>
                            {% endif %}
                        {% endfor %}
                    </div>
                    
                    <div class="multilingual-descriptions mt-4">
                        <div class="description-content active" data-lang="fr">
                            {{ produit.description|raw }}
                        </div>
                        {% for desc in produit.descriptionsMultilingues %}
                            {% if desc.langue != 'fr' %}
                                <div class="description-content" data-lang="{{ desc.langue }}">
                                    {{ desc.contenu|raw }}
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="mt-4">
                        {{ produit.description|raw }}
                    </div>
                {% endif %}
                
              
                
             
                
                <!-- Boutons d'action -->
                <div class="action-buttons">
                    <a href="{{ path('app_commander', {'id': produit.id}) }}" 
   class="btn btn-command btn-lg" id="btn-commander">
    <i class="bi bi-cart-check me-2"></i>Commander maintenant
</a>
                    <button class="btn btn-cart btn-lg" id="btn-add-cart">
                        <i class="bi bi-cart-plus me-2"></i>Ajouter au panier
                    </button>
                </div>
                
                <!-- Pharmacies associées -->
                {% if produit.parapharmacies|length > 0 %}
                    <div class="mt-4">
                        <h6>Disponible dans :</h6>
                        <div class="d-flex flex-wrap gap-2">
                            {% for parapharmacie in produit.parapharmacies %}
                                <span class="badge bg-primary">{{ parapharmacie.nom }}</span>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>
            
        <!-- Colonne droite : Image produit -->
<div class="col-lg-6 col-md-12">
    <div class="product-image-container">
        {% if produit.image %}
            <img src="{{ asset('uploads/images/produits/' ~ produit.image) }}" 
                 alt="{{ produit.nom }}"
                 class="product-image"
                 onerror="this.onerror=null; this.src='{{ asset('uploads/products/' ~ produit.image) }}'; 
                          this.onerror=function(){ this.onerror=null; this.src='https://via.placeholder.com/400x400?text=Image+non+disponible'; }">
        {% else %}
            <div class="text-center">
                <i class="bi bi-image" style="font-size: 100px; color: #ccc;"></i>
                <p class="mt-3 text-muted">Aucune image disponible</p>
            </div>
        {% endif %}
    </div>
</div>
    
    <!-- Caractéristiques détaillées -->
    {% if produit.caracteristiques is defined and produit.caracteristiques %}
        <div class="info-section">
            <h3 class="section-title">Caractéristiques détaillées</h3>
            <div class="features-grid">
                {% for caracteristique in produit.caracteristiques %}
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <h5>{{ caracteristique.titre }}</h5>
                        <p class="mb-0">{{ caracteristique.description }}</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- TABLEAU DES PHARMACIES QUI ONT CE PRODUIT -->
    <div class="info-section mt-4">
        <h3 class="section-title">
            <i class="bi bi-shop me-2"></i> Pharmacies proposant ce produit
        </h3>
        
        {% if pharmaciesAvecProduit|length > 0 %}
            <div class="alert alert-success mb-4">
                <div class="d-flex align-items-center">
                    <i class="bi bi-check-circle fs-4 me-3"></i>
                    <div>
                        Ce produit est disponible dans <strong>{{ pharmaciesAvecProduit|length }}</strong> pharmacie(s).
                    </div>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-hover align-middle pharmacy-table">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Pharmacie</th>
                           
                            <th>Prix</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pharmacie in pharmaciesAvecProduit %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <div class="pharmacy-icon me-3">
                                            <i class="bi bi-shop"></i>
                                        </div>
                                        <div>
                                            <strong>{{ pharmacie.nom }}</strong>
                                        </div>
                                    </div>
                                </td>
                             
                             
                                <td>
                                    <div class="pharmacy-price-tag">
                                        {{ produit.prix|number_format(2, ',', ' ') }} €
                                    </div>
                                    <small class="text-muted">Prix unitaire</small>
                                </td>
                                <td>
                                    <div class="table-actions">
                                        <button class="btn btn-success btn-sm" 
                                                onclick="commanderChezPharmacie({{ pharmacie.id }}, '{{ produit.nom|escape('js') }}', '{{ produit.prix }}')">
                                            <i class="bi bi-cart-check me-1"></i> Commander
                                        </button>
                                        <button class="btn btn-outline-primary btn-sm" 
                                                onclick="ajouterAuPanierPharmacie({{ pharmacie.id }}, '{{ produit.nom|escape('js') }}', '{{ produit.prix }}', {{ produit.id }})">
                                            <i class="bi bi-cart-plus me-1"></i> Ajouter au panier
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
        {% else %}
            <div class="alert alert-warning">
                <div class="d-flex align-items-center">
                    <i class="bi bi-exclamation-triangle fs-4 me-3"></i>
                    <div>
                        <strong>Ce produit n'est disponible dans aucune pharmacie pour le moment.</strong><br>
                        Contactez les pharmacies pour vérifier la disponibilité.
                    </div>
                </div>
            </div>
            
        {% endif %}
    </div>
    <!-- FIN TABLEAU DES PHARMACIES -->
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Gestion de la quantité
        const quantityInput = document.querySelector('.product-qty');
        const decreaseBtn = document.querySelector('.decrease-qty');
        const increaseBtn = document.querySelector('.increase-qty');
        const btnCommander = document.getElementById('btn-commander');
        const btnAddCart = document.getElementById('btn-add-cart');
        
        if (decreaseBtn) {
            decreaseBtn.addEventListener('click', function() {
                let currentValue = parseInt(quantityInput.value);
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                }
            });
        }
        
        if (increaseBtn) {
            increaseBtn.addEventListener('click', function() {
                let currentValue = parseInt(quantityInput.value);
                if (currentValue < 99) {
                    quantityInput.value = currentValue + 1;
                }
            });
        }
        
        // Gestion des langues
        document.querySelectorAll('.language-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const lang = this.dataset.lang;
                
                // Mettre à jour les boutons actifs
                document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                // Afficher la bonne description
                document.querySelectorAll('.description-content').forEach(content => {
                    content.classList.remove('active');
                    if (content.dataset.lang === lang) {
                        content.classList.add('active');
                    }
                });
            });
        });
        
        // Gestion des boutons d'action
        if (btnCommander) {
            btnCommander.addEventListener('click', function() {
                const quantity = quantityInput.value;
                // Ici vous pouvez ajouter la logique de commande
                alert(`Commande de ${quantity} unité(s) de "${document.querySelector('.product-title').textContent}"`);
            });
        }
        
        if (btnAddCart) {
            btnAddCart.addEventListener('click', function() {
                const quantity = quantityInput.value;
                ajouterAuPanierGlobal('{{ produit.nom|escape('js') }}', '{{ produit.prix }}', {{ produit.id }}, quantity);
            });
        }
    });

    // Fonction pour commander chez une pharmacie spécifique
    function commanderChezPharmacie(pharmacieId, produitNom, prix) {
        const quantity = document.querySelector('.product-qty').value;
        const total = (parseFloat(prix) * parseInt(quantity)).toFixed(2);
        
        if (confirm(`Confirmer la commande de ${quantity} unité(s) de "${produitNom}" ?\n\nPrix unitaire: ${prix} €\nTotal: ${total} €`)) {
            // Simuler l'envoi de commande
            const message = `Commande envoyée à la pharmacie #${pharmacieId}:\n\n` +
                           `- Produit: ${produitNom}\n` +
                           `- Quantité: ${quantity}\n` +
                           `- Prix unitaire: ${prix} €\n` +
                           `- Total: ${total} €\n\n` +
                           `Vous serez contacté(e) sous peu pour finaliser la commande.`;
            
            alert(message);
            
            // En production, vous pourriez utiliser:
            // window.location.href = `/commander/${pharmacieId}?produit={{ produit.id }}&quantite=${quantity}`;
        }
    }

    // Fonction pour ajouter au panier depuis une pharmacie spécifique
    function ajouterAuPanierPharmacie(pharmacieId, produitNom, prix, produitId) {
        const quantity = document.querySelector('.product-qty').value;
        const total = (parseFloat(prix) * parseInt(quantity)).toFixed(2);
        
        // Simuler l'ajout au panier
        const message = `${quantity} unité(s) de "${produitNom}" ajoutée(s) au panier depuis la pharmacie #${pharmacieId}\n\n` +
                       `- Prix unitaire: ${prix} €\n` +
                       `- Total: ${total} €\n\n` +
                       `Vous pouvez continuer vos achats ou finaliser votre commande.`;
        
        alert(message);
        
        // En production, vous pourriez utiliser:
        // window.location.href = `/panier/ajouter/${produitId}?pharmacie=${pharmacieId}&quantite=${quantity}`;
    }

    // Fonction pour ajouter au panier global (depuis la section principale)
    function ajouterAuPanierGlobal(produitNom, prix, produitId, quantity) {
        const total = (parseFloat(prix) * parseInt(quantity)).toFixed(2);
        
        // Simuler l'ajout au panier
        const message = `${quantity} unité(s) de "${produitNom}" ajoutée(s) au panier\n\n` +
                       `- Prix unitaire: ${prix} €\n` +
                       `- Total: ${total} €\n\n` +
                       `Vous pouvez continuer vos achats ou finaliser votre commande.`;
        
        alert(message);
        
        // En production, vous pourriez utiliser:
        // window.location.href = `/panier/ajouter/${produitId}?quantite=${quantity}`;
    }

    // Fonction pour demander la disponibilité
    function demanderDisponibilite(pharmacieId, produitNom) {
        const message = `Bonjour,\n\nJe souhaite savoir si le produit "${produitNom}" est disponible dans votre pharmacie.\n\nPouvez-vous me confirmer la disponibilité et le prix exact ?\n\nMerci,\nCordialement.`;
        
        if (confirm(`Envoyer une demande de disponibilité pour "${produitNom}" ?`)) {
            alert(`Demande envoyée à la pharmacie !\n\nMessage:\n${message}\n\n(Ceci est une simulation)`);
        }
    }

    // Exposer les fonctions globalement
    window.commanderChezPharmacie = commanderChezPharmacie;
    window.ajouterAuPanierPharmacie = ajouterAuPanierPharmacie;
    window.ajouterAuPanierGlobal = ajouterAuPanierGlobal;
    window.demanderDisponibilite = demanderDisponibilite;
    </script>
{% endblock %}