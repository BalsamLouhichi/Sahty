<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Fiche M√©dicale #{{ fiche.id }}</title>
    <style>
        @page { margin: 2cm; }
        body { font-family: 'Helvetica', 'Arial', sans-serif; font-size: 12pt; line-height: 1.6; color: #333; }
        .header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #667eea; }
        .header h1 { color: #667eea; font-size: 24pt; margin: 0; font-weight: bold; }
        .header .subtitle { color: #666; font-size: 11pt; margin-top: 5px; }
        .info-box { background: #f8f9ff; border-left: 5px solid #667eea; padding: 15px; margin-bottom: 20px; }
        .info-box h2 { color: #667eea; font-size: 14pt; margin: 0 0 10px 0; font-weight: bold; }
        .info-row { display: flex; margin-bottom: 8px; }
        .info-label { font-weight: bold; color: #667eea; width: 180px; }
        .info-value { flex: 1; color: #333; }
        .section { margin-bottom: 25px; page-break-inside: avoid; }
        .section-title { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 10px 15px; font-size: 14pt; font-weight: bold; margin-bottom: 15px; }
        .section-content { padding: 10px 15px; border: 1px solid #e8ecff; background: white; min-height: 60px; }
        .two-column { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .patient-section { background: #f0f9ff; border-left: 5px solid #3b82f6; padding: 15px; }
        .medecin-section { background: #fef3f2; border-left: 5px solid #dc2626; padding: 15px; }
        .badge { display: inline-block; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 10pt; }
        .badge-actif { background: #d4edda; color: #155724; }
        .badge-modifie { background: #fff3cd; color: #856404; }
        .badge-inactif { background: #f8d7da; color: #721c24; }
        .imc-box { background: #e8f5e9; border: 2px solid #4caf50; padding: 10px; margin-top: 10px; text-align: center; }
        .imc-value { font-size: 18pt; font-weight: bold; color: #2e7d32; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 2px solid #667eea; text-align: center; color: #666; font-size: 10pt; }
        .print-date { text-align: right; color: #999; font-size: 10pt; margin-bottom: 20px; }
        @media print { body { margin: 0; } .no-print { display: none; } }
    </style>
</head>
<body>
    <div class="print-date">
        Imprim√© le : {{ "now"|date("d/m/Y √† H:i") }}
    </div>

    <div class="header">
        <h1>üìã FICHE M√âDICALE</h1>
        <div class="subtitle">Dossier M√©dical Patient - MEDINOVA</div>
        <div class="subtitle">Fiche N¬∞ {{ fiche.id }}</div>
    </div>

    <!-- Informations Patient -->
    <div class="info-box">
        <h2>üë§ INFORMATIONS PATIENT</h2>
        {% if fiche.patient %}
            <div class="info-row">
                <span class="info-label">Nom complet :</span>
                <span class="info-value">{{ fiche.patient.nom|upper }} {{ fiche.patient.prenom }}</span>
            </div>
            {% if fiche.patient.dateNaissance %}
            <div class="info-row">
                <span class="info-label">Date de naissance :</span>
                <span class="info-value">{{ fiche.patient.dateNaissance|date("d/m/Y") }}</span>
            </div>
            {% endif %}
            {% if fiche.patient.email %}
            <div class="info-row">
                <span class="info-label">Email :</span>
                <span class="info-value">{{ fiche.patient.email }}</span>
            </div>
            {% endif %}
            {% if fiche.patient.telephone %}
            <div class="info-row">
                <span class="info-label">T√©l√©phone :</span>
                <span class="info-value">{{ fiche.patient.telephone }}</span>
            </div>
            {% endif %}
        {% endif %}

        <div class="info-row">
            <span class="info-label">Statut de la fiche :</span>
            <span class="info-value">
                <span class="badge badge-{{ fiche.statut|lower }}">{{ fiche.statut|upper }}</span>
            </span>
        </div>

        <div class="info-row">
            <span class="info-label">Cr√©√©e le :</span>
            <span class="info-value">{{ fiche.creeLe|date("d/m/Y √† H:i") }}</span>
        </div>

        {% if fiche.modifieLe %}
        <div class="info-row">
            <span class="info-label">Derni√®re modification :</span>
            <span class="info-value">{{ fiche.modifieLe|date("d/m/Y √† H:i") }}</span>
        </div>
        {% endif %}
    </div>

    <!-- Mesures Physiques -->
    {% if fiche.taille or fiche.poids %}
    <div class="section">
        <div class="section-title">üìè MESURES PHYSIQUES</div>
        <div class="section-content">
            <div class="info-row">
                <span class="info-label">Taille :</span>
                <span class="info-value">{{ fiche.taille }} m√®tres</span>
            </div>
            <div class="info-row">
                <span class="info-label">Poids :</span>
                <span class="info-value">{{ fiche.poids }} kg</span>
            </div>

            {% if fiche.imc %}
            <div class="imc-box">
                <div>Indice de Masse Corporelle (IMC)</div>
                <div class="imc-value">{{ fiche.imc|number_format(2) }}</div>
                <div>Cat√©gorie : <strong>{{ fiche.categorieImc }}</strong></div>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Ant√©c√©dents et Allergies -->
    <div class="two-column">
        {% if fiche.antecedents %}
        <div class="section">
            <div class="section-title">üè• ANT√âC√âDENTS M√âDICAUX</div>
            <div class="section-content patient-section">{{ fiche.antecedents|nl2br }}</div>
        </div>
        {% endif %}

        {% if fiche.allergies %}
        <div class="section">
            <div class="section-title">‚ö†Ô∏è ALLERGIES</div>
            <div class="section-content patient-section">{{ fiche.allergies|nl2br }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Traitements en cours -->
    {% if fiche.traitementEnCours %}
    <div class="section">
        <div class="section-title">üíä TRAITEMENTS EN COURS</div>
        <div class="section-content patient-section">{{ fiche.traitementEnCours|nl2br }}</div>
    </div>
    {% endif %}

    <!-- Diagnostic -->
    {% if fiche.diagnostic %}
    <div class="section">
        <div class="section-title">ü©∫ DIAGNOSTIC M√âDICAL</div>
        <div class="section-content medecin-section">{{ fiche.diagnostic|nl2br }}</div>
    </div>
    {% endif %}

    <!-- Traitement Prescrit -->
    {% if fiche.traitementPrescrit %}
    <div class="section">
        <div class="section-title">üìã TRAITEMENT PRESCRIT</div>
        <div class="section-content medecin-section">{{ fiche.traitementPrescrit|nl2br }}</div>
    </div>
    {% endif %}

    <!-- Observations -->
    {% if fiche.observations %}
    <div class="section">
        <div class="section-title">üìù OBSERVATIONS M√âDICALES</div>
        <div class="section-content medecin-section">{{ fiche.observations|nl2br }}</div>
    </div>
    {% endif %}

    <div class="footer">
        <p><strong>MEDINOVA - Centre M√©dical</strong></p>
        <p>Document confidentiel - Usage strictement m√©dical</p>
        <p style="margin-top: 10px; font-size: 9pt;">
            Ce document contient des informations m√©dicales confidentielles prot√©g√©es par le secret m√©dical.
        </p>
    </div>

    <script>
        window.onload = function() { window.print(); };
    </script>
</body>
</html>
