<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <title>MEDINOVA - Inscription</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{{ asset('css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet">
    <style>
        .role-card { cursor:pointer; border:2px solid #dee2e6; transition:0.3s; margin-bottom:15px; }
        .role-card.active { border-color:#0d6efd; background:#f0f8ff; }
        .role-specific { display:none; margin-top:20px; padding:15px; border:1px solid #dee2e6; border-radius:5px; background:#f8f9fa; }
        .form-section { margin-bottom: 30px; }
        .required-field::after { content: " *"; color: #dc3545; }
    </style>
</head>

<body>
{% include 'partials/navbar.html.twig' %}

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h2 class="text-center mb-4">Créer un compte Medinova</h2>

            {# Affichage des messages flash #}
            {% for message in app.flashes('success') %}
                <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
            {% for message in app.flashes('error') %}
                <div class="alert alert-danger">{{ message }}</div>
            {% endfor %}

            {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate', 'enctype': 'multipart/form-data', 'id': 'signup-form'}}) }}

                {# Sélection du rôle avec cards #}
                <div class="form-section">
                    <h4 class="mb-3">Sélectionnez votre rôle <span class="text-danger">*</span></h4>
                    <div class="row g-3 mt-3">
                        {% for role, info in {
                            'patient': {'icon':'fas fa-user-injured','label':'Patient','desc':'Prenez rendez-vous, consultez vos résultats et gérez votre santé'},
                            'medecin': {'icon':'fas fa-user-md','label':'Médecin','desc':'Gérez vos patients, prescriptions et consultations'},
                            'responsable_labo': {'icon':'fas fa-flask','label':'Responsable Laboratoire','desc':'Gérez les analyses et résultats de laboratoire'},
                            'responsable_para': {'icon':'fas fa-stethoscope','label':'Responsable Parapharmacie','desc':'Gérez les services paramédicaux et soins'}
                        } %}
                        <div class="col-md-6">
                            <div class="role-card text-center p-4 rounded" data-role="{{ role }}">
                                <div class="role-icon text-primary"><i class="{{ info.icon }} fa-2x"></i></div>
                                <h5>{{ info.label }}</h5>
                                <p class="text-muted small">{{ info.desc }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="mt-3">
                        {{ form_label(form.role) }}
                        {{ form_widget(form.role, {'attr': {'class': 'form-control', 'id': 'role_select'}}) }}
                        <div class="text-danger">{{ form_errors(form.role) }}</div>
                    </div>
                </div>

                <hr>

                {# Infos générales #}
                <div class="form-section">
                    <h4 class="mb-3">Informations générales</h4>
                    <div class="row g-3">
                        <div class="col-md-6">
                            {{ form_label(form.nom, null, {'label_attr': {'class': 'required-field'}}) }}
                            {{ form_widget(form.nom, {'attr': {'class': 'form-control'}}) }}
                            <div class="text-danger">{{ form_errors(form.nom) }}</div>
                        </div>
                        <div class="col-md-6">
                            {{ form_label(form.prenom, null, {'label_attr': {'class': 'required-field'}}) }}
                            {{ form_widget(form.prenom, {'attr': {'class': 'form-control'}}) }}
                            <div class="text-danger">{{ form_errors(form.prenom) }}</div>
                        </div>
                        <div class="col-md-6">
                            {{ form_label(form.email, null, {'label_attr': {'class': 'required-field'}}) }}
                            {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
                            <div class="text-danger">{{ form_errors(form.email) }}</div>
                        </div>
                        <div class="col-md-6">
                            {{ form_label(form.telephone) }}
                            {{ form_widget(form.telephone, {'attr': {'class': 'form-control'}}) }}
                            <div class="text-danger">{{ form_errors(form.telephone) }}</div>
                        </div>
                        <div class="col-md-6">
                            {{ form_label(form.dateNaissance) }}
                            {{ form_widget(form.dateNaissance, {'attr': {'class': 'form-control'}}) }}
                            <div class="text-danger">{{ form_errors(form.dateNaissance) }}</div>
                        </div>
                        <div class="col-md-6">
                            {{ form_label(form.password, null, {'label_attr': {'class': 'required-field'}}) }}
                            {{ form_widget(form.password, {'attr': {'class': 'form-control', 'id': 'password_field'}}) }}
                            <div class="text-danger">{{ form_errors(form.password) }}</div>
                        </div>
                        <div class="col-md-6">
                            <label class="required-field">Confirmer le mot de passe</label>
                            <input type="password" class="form-control" name="confirm_password" id="confirm_password" required minlength="6">
                        </div>
                        <div class="col-md-6">
                            {{ form_label(form.photoProfil) }}
                            {{ form_widget(form.photoProfil, {'attr': {'class': 'form-control'}}) }}
                            <div class="text-danger">{{ form_errors(form.photoProfil) }}</div>
                        </div>
                    </div>
                </div>

                {# Infos spécifiques selon rôle - Using Symfony form fields #}
                <div id="patient-info" class="role-specific">
                    <h5 class="mb-3">Informations Patient</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label>Sexe</label>
                            {{ form_widget(form.sexe, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Groupe sanguin</label>
                            {{ form_widget(form.groupeSanguin, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Contact urgence</label>
                            {{ form_widget(form.contactUrgence, {'attr': {'class': 'form-control'}}) }}
                        </div>
                    </div>
                </div>

                <div id="medecin-info" class="role-specific">
                    <h5 class="mb-3">Informations Médecin</h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label>Spécialité</label>
                            {{ form_widget(form.specialite, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Années expérience</label>
                            {{ form_widget(form.anneeExperience, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Grade</label>
                            {{ form_widget(form.grade, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Adresse cabinet</label>
                            {{ form_widget(form.adresseCabinet, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Téléphone cabinet</label>
                            {{ form_widget(form.telephoneCabinet, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Nom établissement</label>
                            {{ form_widget(form.nomEtablissement, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Numéro urgence</label>
                            {{ form_widget(form.numeroUrgence, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-md-6">
                            <label>Document PDF</label>
                            {{ form_widget(form.documentPdf, {'attr': {'class': 'form-control'}}) }}
                        </div>
                        <div class="col-12">
                            <label>Disponibilités</label>
                            {{ form_widget(form.disponibilite, {'attr': {'class': 'form-control', 'rows': '3'}}) }}
                        </div>
                    </div>
                </div>

                <div id="responsable_labo-info" class="role-specific">
                    <h5 class="mb-3">Informations Responsable Laboratoire</h5>
                    <div class="col-md-6">
                        <label>Laboratoire</label>
                        {{ form_widget(form.laboratoire, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>

                <div id="responsable_para-info" class="role-specific">
                    <h5 class="mb-3">Informations Responsable Parapharmacie</h5>
                    <div class="col-md-6">
                        <label>ID Parapharmacie</label>
                        {{ form_widget(form.parapharmacieId, {'attr': {'class': 'form-control'}}) }}
                    </div>
                </div>

                <div class="form-section text-center">
                    <button type="submit" class="btn btn-success btn-lg px-5">Créer mon compte</button>
                    <p class="mt-3">
                        Déjà un compte ? <a href="{{ path('app_login') }}">Connectez-vous ici</a>
                    </p>
                </div>

            {{ form_end(form) }}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const roleCards = document.querySelectorAll('.role-card');
    const roleSections = document.querySelectorAll('.role-specific');
    const roleSelect = document.getElementById('role_select');
    
    // Function to show/hide sections based on selected role
    function updateSections(role) {
        // Hide all sections
        roleSections.forEach(sec => sec.style.display = 'none');
        
        // Show the selected section if it exists
        if (role) {
            const section = document.getElementById(role + '-info');
            if(section) {
                section.style.display = 'block';
            }
        }
    }
    
    // Function to update cards based on select value
    function updateCards(role) {
        roleCards.forEach(card => {
            card.classList.remove('active');
            if (card.dataset.role === role) {
                card.classList.add('active');
            }
        });
    }
    
    // Card click handlers
    roleCards.forEach(card => {
        card.addEventListener('click', function() {
            const role = this.dataset.role;
            
            // Update select value
            if (roleSelect) {
                roleSelect.value = role;
                // Trigger change event to update sections
                const event = new Event('change', { bubbles: true });
                roleSelect.dispatchEvent(event);
            }
            
            // Update cards
            updateCards(role);
        });
    });
    
    // Select change handler
    if (roleSelect) {
        roleSelect.addEventListener('change', function() {
            const role = this.value;
            updateCards(role);
            updateSections(role);
        });
        
        // Initialize on page load
        if (roleSelect.value) {
            updateCards(roleSelect.value);
            updateSections(roleSelect.value);
        }
    }
    
    // Form validation
    const form = document.getElementById('signup-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const password = document.getElementById('password_field')?.value;
            const confirmPassword = document.getElementById('confirm_password')?.value;
            const role = roleSelect?.value;
            
            // Check if role is selected
            if (!role) {
                e.preventDefault();
                alert('Veuillez sélectionner un rôle !');
                return false;
            }
            
            // Check if password is provided
            if (!password) {
                e.preventDefault();
                alert('Veuillez entrer un mot de passe !');
                document.getElementById('password_field')?.focus();
                return false;
            }
            
            // Check password length
            if (password.length < 6) {
                e.preventDefault();
                alert('Le mot de passe doit contenir au moins 6 caractères !');
                document.getElementById('password_field')?.focus();
                return false;
            }
            
            // Check if passwords match
            if (password !== confirmPassword) {
                e.preventDefault();
                alert('Les mots de passe ne correspondent pas !');
                document.getElementById('confirm_password')?.focus();
                return false;
            }
            
            return true;
        });
    }
});
</script>

<script src="{{ asset('js/bootstrap.bundle.min.js') }}"></script>
</body>
</html>