<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier mon profil - MEDINOVA</title>
    <link href="{{ asset('css/bootstrap.min.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .profile-edit-card { border: none; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .profile-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 15px 15px 0 0; }
        .profile-avatar { width: 150px; height: 150px; border-radius: 50%; border: 5px solid white; object-fit: cover; }
        .avatar-container { position: relative; display: inline-block; }
        .avatar-change-btn { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
        .form-group { margin-bottom: 1.5rem; }
        .btn-save { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; }
        .btn-save:hover { background: linear-gradient(135deg, #5a6fd8 0%, #6a4090 100%); }
        .current-photo { max-width: 100%; border-radius: 10px; margin-top: 10px; }
        .info-section { background: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 25px; }
        .section-title { color: #667eea; border-bottom: 2px solid #e9ecef; padding-bottom: 10px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
        <div class="container">
            <a class="navbar-brand" href="{{ path('app_home') }}">
                <i class="fas fa-stethoscope me-2"></i>MEDINOVA
            </a>
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle me-2"></i>
                        {{ app.user.prenom }}
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{{ path('app_profile') }}"><i class="fas fa-user me-2"></i>Mon Profil</a></li>
                        <li><a class="dropdown-item" href="{{ path('app_profile_edit') }}"><i class="fas fa-edit me-2"></i>Modifier Profil</a></li>
                        <li><a class="dropdown-item" href="{{ path('app_profile_change_password') }}"><i class="fas fa-key me-2"></i>Changer mot de passe</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ path('app_logout') }}"><i class="fas fa-sign-out-alt me-2"></i>Déconnexion</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <!-- Messages flash -->
                {% for message in app.flashes('success') %}
                    <div class="alert alert-success alert-dismissible fade show">
                        <i class="fas fa-check-circle me-2"></i>{{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
                
                {% for message in app.flashes('error') %}
                    <div class="alert alert-danger alert-dismissible fade show">
                        <i class="fas fa-exclamation-triangle me-2"></i>{{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}

                <!-- Boutons d'action - MAINTENANT EN HAUT -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <a href="{{ path('app_profile') }}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Retour au profil
                    </a>
                    
                    <div>
                        <a href="{{ path('app_profile_change_password') }}" class="btn btn-outline-primary me-2">
                            <i class="fas fa-key me-2"></i>Changer mot de passe
                        </a>
                        <button type="submit" form="profileForm" class="btn btn-save text-white px-4">
                            <i class="fas fa-save me-2"></i>Enregistrer
                        </button>
                    </div>
                </div>

                <!-- Carte d'édition du profil -->
                <div class="card profile-edit-card">
                    <div class="profile-header p-4">
                        <div class="d-flex align-items-center justify-content-center">
                            <h3 class="mb-0"><i class="fas fa-user-edit me-2"></i>Modifier mon profil</h3>
                        </div>
                    </div>
                    
                    <div class="card-body p-5">
                        <!-- Photo de profil et informations en ligne -->
                        <div class="row mb-5 align-items-center">
                            <div class="col-md-3 text-center">
                                <div class="avatar-container mb-3">
                                    {% if user.photoProfil %}
                                        <img src="{{ asset(user.photoProfil) }}" class="profile-avatar" alt="Photo de profil actuelle">
                                    {% else %}
                                        <div class="profile-avatar d-flex align-items-center justify-content-center bg-light text-primary" style="font-size: 4rem;">
                                            <i class="fas fa-user"></i>
                                        </div>
                                    {% endif %}
                                    <label for="profile_edit_photoProfil" class="avatar-change-btn">
                                        <i class="fas fa-camera"></i>
                                    </label>
                                </div>
                                <p class="text-muted small">Cliquez pour changer la photo</p>
                            </div>
                            
                            <div class="col-md-9">
                                <!-- Informations non modifiables -->
                                <div class="info-section">
                                    <h5 class="section-title"><i class="fas fa-info-circle me-2"></i>Informations du compte</h5>
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <p><strong><i class="fas fa-user-tag me-2"></i>Rôle:</strong><br>
                                            <span class="text-primary">{{ user.role|capitalize }}</span></p>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <p><strong><i class="fas fa-calendar-alt me-2"></i>Date d'inscription:</strong><br>
                                            <span class="text-muted">{{ user.creeLe|date('d/m/Y') }}</span></p>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            {% if user.role == 'medecin' %}
                                                <p><strong><i class="fas fa-stethoscope me-2"></i>Spécialité:</strong><br>
                                                <span class="text-muted">{{ user.specialite ?: 'Non renseignée' }}</span></p>
                                            {% elseif user.role == 'patient' %}
                                                <p><strong><i class="fas fa-tint me-2"></i>Groupe sanguin:</strong><br>
                                                <span class="text-muted">{{ user.groupeSanguin ?: 'Non renseigné' }}</span></p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Formulaire - TOUS LES CHAMPS ICI -->
                        {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate', 'id': 'profileForm'}}) }}
                        
                            <!-- Section Informations personnelles -->
                            <div class="info-section mb-4">
                                <h5 class="section-title"><i class="fas fa-user-circle me-2"></i>Informations personnelles</h5>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            {{ form_label(form.prenom) }}
                                            {{ form_widget(form.prenom, {'attr': {'class': 'form-control'}}) }}
                                            <div class="text-danger">{{ form_errors(form.prenom) }}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            {{ form_label(form.nom) }}
                                            {{ form_widget(form.nom, {'attr': {'class': 'form-control'}}) }}
                                            <div class="text-danger">{{ form_errors(form.nom) }}</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            {{ form_label(form.dateNaissance) }}
                                            {{ form_widget(form.dateNaissance, {'attr': {'class': 'form-control'}}) }}
                                            <div class="text-danger">{{ form_errors(form.dateNaissance) }}</div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            {{ form_label(form.telephone) }}
                                            {{ form_widget(form.telephone, {'attr': {'class': 'form-control'}}) }}
                                            <div class="text-danger">{{ form_errors(form.telephone) }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Section Contact -->
                            <div class="info-section mb-4">
                                <h5 class="section-title"><i class="fas fa-envelope me-2"></i>Informations de contact</h5>
                                
                                <div class="form-group">
                                    {{ form_label(form.email) }}
                                    {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
                                    <div class="text-danger">{{ form_errors(form.email) }}</div>
                                </div>
                            </div>

                            <!-- Section Photo -->
                            <div class="info-section mb-4">
                                <h5 class="section-title"><i class="fas fa-image me-2"></i>Photo de profil</h5>
                                
                                <div class="form-group">
                                    {{ form_label(form.photoProfil) }}
                                    <div class="input-group">
                                        {{ form_widget(form.photoProfil, {'attr': {'class': 'form-control'}}) }}
                                    </div>
                                    <small class="form-text text-muted">
                                        <i class="fas fa-info-circle me-1"></i>Formats acceptés: JPG, PNG, GIF, WebP. Taille max: 1MB
                                    </small>
                                    <div class="text-danger">{{ form_errors(form.photoProfil) }}</div>
                                </div>
                            </div>
                        
                        {{ form_end(form) }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>