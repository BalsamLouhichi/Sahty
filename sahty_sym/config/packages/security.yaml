
security:
    enable_authenticator_manager: true  # Nécessaire pour Symfony 5.4+
    
    password_hashers:
        Symfony\Component\Security\Core\User\PasswordAuthenticatedUserInterface: 'auto'
        App\Entity\Utilisateur:
            algorithm: auto

    providers:
        app_user_provider:
            entity:
                class: App\Entity\Utilisateur
                property: email

    firewalls:
        dev:
            pattern: ^/(_(profiler|wdt)|css|images|js)/
            security: false

        main:
            pattern: ^/
            lazy: true
            provider: app_user_provider
            
            # Configuration du formulaire de login
            form_login:
                login_path: app_login              # Nom de la route, pas le chemin
                check_path: app_login              # Même route pour la validation
                username_parameter: _username      # Nom du paramètre dans le formulaire
                password_parameter: _password      # Nom du paramètre dans le formulaire
                enable_csrf: true                  # Activer la protection CSRF
                csrf_parameter: _csrf_token        # Nom du paramètre CSRF
                csrf_token_id: authenticate        # ID du token CSRF
                success_handler: App\Security\AuthenticationSuccessHandler  # Gestionnaire personnalisé
                failure_path: app_login            # Redirection en cas d'échec
                
            


            
            # Configuration de la déconnexion
            logout:
                path: app_logout                   # Nom de la route
                target: app_home                   # Redirection après logout
            
            # Option "Se souvenir de moi"
            remember_me:
                secret: '%kernel.secret%'
                lifetime: 604800                   # 1 semaine en secondes
                path: /
                always_remember_me: false
                remember_me_parameter: _remember_me

    access_control:
        # Pages publiques (accessibles sans connexion)
        - { path: ^/login$, roles: PUBLIC_ACCESS, methods: [GET, POST] }
        - { path: ^/signup$, roles: PUBLIC_ACCESS }
        - { path: ^/register$, roles: PUBLIC_ACCESS }
        - { path: ^/$, roles: PUBLIC_ACCESS }  
        - { path: ^/forgot, roles: PUBLIC_ACCESS }
        
        
            # Page d'accueil
        
        # Pages protégées par rôle
        - { path: ^/admin/, roles: ROLE_ADMIN }
        - { path: ^/medecin/, roles: ROLE_MEDECIN }
        - { path: ^/patient/, roles: ROLE_PATIENT }
        - { path: ^/laboratoire/, roles: ROLE_RESPONSABLE_LABO }
        - { path: ^/parapharmacie/, roles: ROLE_RESPONSABLE_PARA }
        
        # Toutes les autres pages nécessitent une connexion
        - { path: ^/, roles: IS_AUTHENTICATED_FULLY }