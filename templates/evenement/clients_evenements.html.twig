{# templates/evenement/clients_evenements.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Tous les événements | MEDINOVA{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .page-header {
            background: linear-gradient(135deg, #13C5DD 0%, #0e9bb0 100%);
            padding: 40px 0;
            margin-bottom: 40px;
            color: white;
        }
        
        .page-header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 0;
        }
        
        .filter-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .event-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(19, 197, 221, 0.15);
        }
        
        .event-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 2;
        }
        
        .event-badge .badge {
            padding: 8px 15px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .event-image {
            height: 180px;
            background: linear-gradient(135deg, #13C5DD 0%, #0e9bb0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
            position: relative;
        }
        
        .event-image .event-date-badge {
            position: absolute;
            bottom: -20px;
            left: 20px;
            background: white;
            border-radius: 10px;
            padding: 10px 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            color: #1E2A4A;
            text-align: center;
        }
        
        .event-image .event-date-badge .day {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
            color: #13C5DD;
        }
        
        .event-image .event-date-badge .month {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .event-content {
            padding: 30px 20px 20px;
            flex: 1;
        }
        
        .event-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1E2A4A;
            margin-bottom: 10px;
            line-height: 1.4;
            height: 3.3em;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .event-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .event-meta-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .event-meta-item i {
            color: #13C5DD;
            width: 20px;
        }
        
        .event-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: #13C5DD;
            margin: 15px 0;
        }
        
        .event-price.free {
            color: #28a745;
        }
        
        .event-footer {
            padding: 20px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-event {
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-view {
            background: #f8f9fa;
            color: #1E2A4A;
            border: 1px solid #dee2e6;
        }
        
        .btn-view:hover {
            background: #e9ecef;
            color: #13C5DD;
        }
        
        .btn-register {
            background: #13C5DD;
            color: white;
        }
        
        .btn-register:hover {
            background: #0e9bb0;
            color: white;
        }
        
        .btn-registered {
            background: #28a745;
            color: white;
            cursor: default;
        }
        
        .btn-registered:hover {
            background: #28a745;
            color: white;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #13C5DD;
            line-height: 1.2;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .registered-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: #28a745;
            color: white;
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .pagination {
            margin-top: 40px;
            justify-content: center;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05);
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #dee2e6;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            color: #1E2A4A;
            margin-bottom: 10px;
        }
        
        .empty-state p {
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .page-header h1 {
                font-size: 1.8rem;
            }
        }
    </style>
{% endblock %}

{% block body %}
    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <h1>
                <i class="fas fa-calendar-alt me-3"></i>
                Tous les événements
            </h1>
            <p class="mb-0 opacity-90">Découvrez tous les événements médicaux disponibles</p>
        </div>
    </div>

    <div class="container py-4">
        <!-- Flash Messages -->
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                    <i class="fas 
                        {% if label == 'success' %}fa-check-circle
                        {% elseif label == 'danger' %}fa-exclamation-circle
                        {% elseif label == 'warning' %}fa-exclamation-triangle
                        {% elseif label == 'info' %}fa-info-circle
                        {% endif %} me-2">
                    </i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endfor %}

        <!-- Statistics -->
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-value">{{ stats.total }}</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ stats.a_venir }}</div>
                <div class="stat-label">À venir</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ stats.gratuits }}</div>
                <div class="stat-label">Gratuits</div>
            </div>
            <div class="stat-item">
                <div class="stat-value">{{ stats.payants }}</div>
                <div class="stat-label">Payants</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-card">
            <form method="get" action="{{ path('evenements_client_all_evenements') }}" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">Type d'événement</label>
                    <select name="type" class="form-select">
                        <option value="">Tous les types</option>
                        <option value="conference" {% if type == 'conference' %}selected{% endif %}>Conférence</option>
                        <option value="atelier" {% if type == 'atelier' %}selected{% endif %}>Atelier</option>
                        <option value="formation" {% if type == 'formation' %}selected{% endif %}>Formation</option>
                        <option value="seminaire" {% if type == 'seminaire' %}selected{% endif %}>Séminaire</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Trier par</label>
                    <select name="tri" class="form-select">
                        <option value="date_asc" {% if tri == 'date_asc' %}selected{% endif %}>Date (croissante)</option>
                        <option value="date_desc" {% if tri == 'date_desc' %}selected{% endif %}>Date (décroissante)</option>
                        <option value="prix_asc" {% if tri == 'prix_asc' %}selected{% endif %}>Prix (croissant)</option>
                        <option value="prix_desc" {% if tri == 'prix_desc' %}selected{% endif %}>Prix (décroissant)</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">Rechercher</label>
                    <div class="input-group">
                        <input type="text" name="recherche" class="form-control" placeholder="Titre, description..." value="{{ recherche }}">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Events Grid -->
        {% if evenements|length > 0 %}
            <div class="row g-4">
                {% for evenement in evenements %}
                    {% set isRegistered = false %}
                    {% if app.user and attribute(evenement, 'inscriptionsCount') is defined %}
                        {# Check if user is registered - you need to pass this info from controller #}
                        {# For now, we'll check via session or you need to add a method to check registration #}
                    {% endif %}
                    
                    <div class="col-lg-4 col-md-6">
                        <div class="event-card">
                            <!-- Registered Badge - Show if user is registered -->
                            {% if evenement.userInscrit is defined and evenement.userInscrit %}
                                <div class="registered-badge">
                                    <i class="fas fa-check-circle"></i>
                                    Inscrit
                                </div>
                            {% endif %}
                            
                            <!-- Status Badge -->
                            <div class="event-badge">
                                <span class="badge {% if evenement.statut == 'planifie' %}bg-success
                                    {% elseif evenement.statut == 'en_attente_approbation' %}bg-warning
                                    {% elseif evenement.statut == 'annule' %}bg-danger
                                    {% elseif evenement.statut == 'termine' %}bg-secondary
                                    {% else %}bg-info{% endif %}">
                                    {{ evenement.statut|replace({'_': ' '})|title }}
                                </span>
                            </div>
                            
                            <!-- Event Image with Date -->
                            <div class="event-image">
                                <i class="fas fa-calendar-check fa-4x"></i>
                                <div class="event-date-badge">
                                    <div class="day">{{ evenement.dateDebut|date('d') }}</div>
                                    <div class="month">{{ evenement.dateDebut|date('M') }}</div>
                                </div>
                            </div>
                            
                            <!-- Event Content -->
                            <div class="event-content">
                                <h3 class="event-title">{{ evenement.titre }}</h3>
                                
                                <div class="event-meta">
                                    <div class="event-meta-item">
                                        <i class="fas fa-clock"></i>
                                        <span>{{ evenement.dateDebut|date('H:i') }} - {{ evenement.dateFin|date('H:i') }}</span>
                                    </div>
                                    <div class="event-meta-item">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span>{{ evenement.lieu ?: 'En ligne' }}</span>
                                    </div>
                                    <div class="event-meta-item">
                                        <i class="fas fa-users"></i>
                                        <span>{{ evenement.inscriptionsCount ?? 0 }} / {{ evenement.placesMax ?? '∞' }} inscrits</span>
                                    </div>
                                </div>
                                
                                <!-- Price -->
                                <div class="event-price {% if evenement.tarif == 0 or evenement.tarif is null %}free{% endif %}">
                                    {% if evenement.tarif and evenement.tarif > 0 %}
                                        {{ evenement.tarif }} TND
                                    {% else %}
                                        Gratuit
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Event Footer -->
                            <div class="event-footer">
                                <a href="{{ path('evenements_client_event_view', {'id': evenement.id}) }}" class="btn-event btn-view">
                                    <i class="fas fa-eye"></i> Détails
                                </a>
                                
                                {% if evenement.userInscrit is defined and evenement.userInscrit %}
                                    {# User is already registered #}
                                    <span class="btn-event btn-registered">
                                        <i class="fas fa-check-circle"></i> Inscrit
                                    </span>
                                {% elseif evenement.statut == 'planifie' or evenement.statut == 'approuve' %}
                                    {% if evenement.createur and evenement.createur.id == app.user.id %}
                                        {# User is the creator - show "Mon événement" #}
                                        <span class="btn-event" style="background:#6c757d; color:white; cursor:default;">
                                            <i class="fas fa-star"></i> Mon événement
                                        </span>
                                    {% elseif evenement.placesMax and evenement.inscriptionsCount >= evenement.placesMax %}
                                        {# Event is full #}
                                        <span class="btn-event" style="background:#dc3545; color:white; cursor:default;">
                                            <i class="fas fa-times-circle"></i> Complet
                                        </span>
                                    {% elseif evenement.dateDebut < date() %}
                                        {# Event already started #}
                                        <span class="btn-event" style="background:#6c757d; color:white; cursor:default;">
                                            <i class="fas fa-clock"></i> Passé
                                        </span>
                                    {% else %}
                                        {# Can register #}
                                        <a href="{{ path('evenements_client_event_view', {'id': evenement.id}) }}" class="btn-event btn-register">
                                            <i class="fas fa-user-plus"></i> S'inscrire
                                        </a>
                                    {% endif %}
                                {% else %}
                                    {# Event not available for registration #}
                                    <span class="btn-event" style="background:#6c757d; color:white; cursor:default;">
                                        <i class="fas fa-ban"></i> Non disponible
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if totalPages > 1 %}
                <nav aria-label="Page navigation" class="pagination">
                    <ul class="pagination">
                        {% for i in 1..totalPages %}
                            <li class="page-item {{ page == i ? 'active' : '' }}">
                                <a class="page-link" href="{{ path('evenements_client_all_evenements', {'page': i, 'type': type, 'recherche': recherche, 'tri': tri}) }}">
                                    {{ i }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </nav>
            {% endif %}
        {% else %}
            <!-- Empty State -->
            <div class="empty-state">
                <i class="fas fa-calendar-times"></i>
                <h3>Aucun événement trouvé</h3>
                <p>Essayez de modifier vos filtres ou revenez plus tard.</p>
                <a href="{{ path('evenements_client_all_evenements') }}" class="btn btn-primary">
                    <i class="fas fa-redo-alt me-2"></i>Réinitialiser les filtres
                </a>
            </div>
        {% endif %}
    </div>
{% endblock %}